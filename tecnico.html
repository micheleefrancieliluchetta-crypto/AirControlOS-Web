<!-- tecnico.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cadastro de TÃ©cnico - AirControl OS</title>

  <link rel="stylesheet" href="css/style.css">

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#1e90ff" />

  <!-- iOS -->
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
</head>
<body>

  <header class="topbar">
    <h1>AirControl OS</h1>
    <button onclick="logout()">Sair</button>
  </header>

  <!-- MENU LATERAL (ATUALIZADO) -->
  <nav class="sidebar">
    <ul>
      <li><a href="dashboard.html">ğŸ  Dashboard</a></li>
      <li><a href="ordem-servico.html">ğŸ“ Ordem de ServiÃ§o - ManutenÃ§Ã£o Corretiva</a></li>
      <li><a href="calendario.html">ğŸ“ Agenda</a></li>
      <li><a href="local.html">ğŸ“ Locais / Unidades</a></li>
      <li><a href="tecnico.html">ğŸ§‘â€ğŸ”§ TÃ©cnicos</a></li>
      <li><a href="usuarios.html">ğŸ‘¤ UsuÃ¡rios - Acesso ao Sistema</a></li>
      <li><a href="aparelhos-por-unidade.html">ğŸ¥ Aparelhos por unidade</a></li>
      <li><a href="pmoc.html">âœ… Checklist PMOC - ManutenÃ§Ã£o Preventiva</a></li>
      <li><a href="pmoc-historico.html">ğŸ“‚ HistÃ³rico PMOC por Aparelho</a></li>
      <li><a href="pmoc-qrcodes.html">ğŸ”³ QR Codes PMOC</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <h2>Cadastrar Novo TÃ©cnico</h2>

    <form class="form-os" id="formTecnico">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" required>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>

      <label for="telefone">Telefone:</label>
      <input type="tel" id="telefone" name="telefone">

      <!-- Cargo (preenchido via script.js / CARGOS) -->
      <label for="cargo">Cargo (funÃ§Ã£o):</label>
      <select id="cargo" name="cargo"></select>

      <label for="nivel">NÃ­vel de Acesso:</label>
      <select id="nivel" name="nivel" required>
        <option value="Admin">Admin</option>
        <!-- depois vocÃª pode adicionar outros nÃ­veis -->
      </select>

      <label for="senha">Senha:</label>
      <input type="password" id="senha" name="senha" required>

      <button type="submit" class="tecnico-btn">Salvar TÃ©cnico</button>
    </form>
  </main>

  <!-- script principal (tudo que define requireLogin, ensureAdmin, etc.) -->
  <script src="js/script.js"></script>

  <!-- Bloqueio de acesso: somente Admin -->
  <script>
    // Garante que o usuÃ¡rio esteja logado
    if (typeof requireLogin === "function") {
      requireLogin();
    }

    // Se existir helper global ensureAdmin (definido no script.js), usa ele
    if (typeof ensureAdmin === "function") {
      ensureAdmin();
    } else {
      // Fallback: lÃª o cargo de vÃ¡rios lugares possÃ­veis
      const cargoBruto =
        sessionStorage.getItem("cargo") ||
        localStorage.getItem("cargo") ||
        localStorage.getItem("role") ||
        "";

      const cargo = cargoBruto.toString().trim().toLowerCase();

      // Considera admin se contiver "admin"
      if (!cargo.includes("admin")) {
        alert("Somente administradores podem acessar esta pÃ¡gina.");
        window.location.href = "dashboard.html";
      }
    }
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('./service-worker.js', { scope: './' })
        .catch(err => console.error('SW erro:', err));
    }
  </script>
</body>
</html>

