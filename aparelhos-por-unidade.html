<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aparelhos por unidade - Sistemas Maxi</title>

  <style>
    body {
      margin: 0;
      background: #f3f4f6;
      font-family: Arial, sans-serif;
    }

    .topo {
      background: #007bff;
      color: white;
      padding: 16px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .voltar {
      background: rgba(255,255,255,0.25);
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      font-size: 14px;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 16px;
    }

    .filtro-card {
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 16px;
    }

    .filtro-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    label {
      font-size: 14px;
      color: #444;
    }

    select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      min-width: 160px;
    }

    .tabela-card {
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    thead {
      background: #e9f2ff;
    }

    th, td {
      padding: 8px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }

    th {
      font-weight: 600;
    }

    tbody tr:hover {
      background: #f7f9fc;
    }

    .msg {
      margin-top: 10px;
      font-size: 13px;
      color: #666;
    }

    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead {
        display: none;
      }

      tbody tr {
        border: 1px solid #eee;
        border-radius: 8px;
        margin-bottom: 8px;
        padding: 6px 8px;
      }

      td {
        border-bottom: none;
        padding: 4px 0;
      }

      td::before {
        content: attr(data-label) ": ";
        font-weight: bold;
      }
    }
  </style>
</head>
<body>

<header class="topo">
  <button class="voltar" onclick="window.location.href='dashboard.html'">←</button>
  Aparelhos por unidade
</header>

<main class="container">

  <!-- FILTROS -->
  <section class="filtro-card">
    <div class="filtro-row">
      <div>
        <label for="cidadeSelect">Cidade:</label><br />
        <select id="cidadeSelect">
          <option value="todas">Todas</option>
          <option value="São Vicente">São Vicente</option>
          <option value="São Bernardo do Campo">São Bernardo do Campo</option>
        </select>
      </div>

      <div>
        <label for="unidadeSelect">Unidade / Código do equipamento:</label><br />
        <select id="unidadeSelect">
          <option value="">Selecione...</option>
        </select>
      </div>
    </div>
    <p class="msg" id="msgFiltro">
      Selecione a cidade e a unidade / código para listar os aparelhos.
    </p>
  </section>

  <!-- TABELA -->
  <section class="tabela-card">
    <table>
      <thead>
        <tr>
          <th>Unidade / Código</th>
          <th>Local / Ambiente</th>
          <th>Marca / Hospital</th>
          <th>BTU</th>
          <th>Modelo</th>
        </tr>
      </thead>
      <tbody id="tabelaCorpo">
        <!-- linhas criadas via JS -->
      </tbody>
    </table>

    <p class="msg" id="msgTabela"></p>
  </section>

</main>

<script>
  // ============================
  // LISTA FIXA – HOSPITAL DE CLÍNICAS (SÃO BERNARDO)
  // (Gerada a partir da planilha que você mandou)
  // ============================
  const APARELHOS_SBC_HC = [
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-001", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-002", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-003", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-004", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-005", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-006", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-007", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-008", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-009", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-010", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-011", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-012", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-013", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-014", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-015", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-016", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-017", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-018", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-019", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-020", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-021", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-022", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-023", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-024", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-025", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-026", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-027", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-028", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-029", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-030", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-031", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-032", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-033", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-034", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-035", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-036", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-037", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-038", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-039", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-040", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-041", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-042", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-043", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-044", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-045", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-046", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-047", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-048", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-049", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-050", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-051", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-052", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-FC.-053", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-001", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-002", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-003", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-004", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-005", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-006", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-007", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-008", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-009", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-010", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-011", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-012", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-013", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-014", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-016", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-017", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-018", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-019", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-020", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-021", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-022", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-023", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-024", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-025", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-026", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-027", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-028", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-029", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-030", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-031", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-032", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-033", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-034", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-037", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-038", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-039", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-040", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-041", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-042", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-043", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-044", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-045", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-046", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-047", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-048", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-049", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "São Bernardo do Campo", hospital: "Hospital de Clínicas", unidadeExterna: "HCLI-MSS-050", local: "", marca: "", btu: "", modelo: "" }
  ];

  // ============================
  // LÓGICA DE TELA
  // ============================

  const API_BASE_URL = "https://aircontrolos-api.onrender.com/api/aparelhos-hdv";

  const cidadeSelect = document.getElementById("cidadeSelect");
  const unidadeSelect = document.getElementById("unidadeSelect");
  const tabelaCorpo = document.getElementById("tabelaCorpo");
  const msgFiltro = document.getElementById("msgFiltro");
  const msgTabela = document.getElementById("msgTabela");

  let TODOS_APARELHOS = [];

  // Carrega dados da API (São Vicente) + fixa (São Bernardo)
  async function carregarAparelhos() {
    try {
      const resp = await fetch(API_BASE_URL);
      let dados = [];
      if (resp.ok) {
        dados = await resp.json();
      }

      const aparelhosSV = Array.isArray(dados)
        ? dados.map(ap => ({
            cidade: ap.cidade || "São Vicente",
            hospital: ap.hospital || "",
            unidadeExterna: ap.unidadeExterna,
            local: ap.local,
            marca: ap.marca,
            btu: ap.btu,
            modelo: ap.modelo
          }))
        : [];

      TODOS_APARELHOS = [...aparelhosSV, ...APARELHOS_SBC_HC];

      if (!TODOS_APARELHOS.length) {
        msgFiltro.textContent = "Nenhum aparelho encontrado.";
        return;
      }

      msgFiltro.textContent =
        'Escolha a cidade e, se quiser, uma unidade / código específico.';

      atualizarSelectUnidades();
    } catch (e) {
      console.error(e);
      msgFiltro.textContent = "Erro ao carregar aparelhos.";
    }
  }

  function atualizarSelectUnidades() {
    const cidade = cidadeSelect.value;
    unidadeSelect.innerHTML = '<option value="">Selecione...</option>';

    let lista = TODOS_APARELHOS;
    if (cidade !== "todas") {
      lista = lista.filter(a => a.cidade === cidade);
    }

    if (!lista.length) {
      msgTabela.textContent = "Nenhum aparelho para esta cidade.";
      tabelaCorpo.innerHTML = "";
      return;
    }

    const codigos = [...new Set(lista.map(a => a.unidadeExterna).filter(Boolean))].sort();

    if (codigos.length > 0) {
      const optTodas = document.createElement("option");
      optTodas.value = "todas";
      optTodas.textContent = "Todas as unidades / códigos";
      unidadeSelect.appendChild(optTodas);
    }

    codigos.forEach(cod => {
      const opt = document.createElement("option");
      opt.value = cod;
      opt.textContent = cod;
      unidadeSelect.appendChild(opt);
    });

    msgTabela.textContent = "";
  }

  function preencherTabela(lista, descricao) {
    tabelaCorpo.innerHTML = "";
    msgTabela.textContent = "";

    if (!lista || !lista.length) {
      msgTabela.textContent = "Nenhum aparelho encontrado " + descricao;
      return;
    }

    lista.forEach(item => {
      const tr = document.createElement("tr");

      const tdUnidade = document.createElement("td");
      tdUnidade.textContent = item.unidadeExterna ?? "-";
      tdUnidade.setAttribute("data-label", "Unidade / Código");

      const tdLocal = document.createElement("td");
      const parteHospital = item.hospital ? item.hospital + " – " : "";
      tdLocal.textContent = parteHospital + (item.local || "-");
      tdLocal.setAttribute("data-label", "Local / Ambiente");

      const tdMarca = document.createElement("td");
      tdMarca.textContent = item.marca || item.cidade || "-";
      tdMarca.setAttribute("data-label", "Marca / Hospital");

      const tdBtu = document.createElement("td");
      tdBtu.textContent = item.btu || "-";
      tdBtu.setAttribute("data-label", "BTU");

      const tdModelo = document.createElement("td");
      tdModelo.textContent = item.modelo || "-";
      tdModelo.setAttribute("data-label", "Modelo");

      tr.appendChild(tdUnidade);
      tr.appendChild(tdLocal);
      tr.appendChild(tdMarca);
      tr.appendChild(tdBtu);
      tr.appendChild(tdModelo);

      tabelaCorpo.appendChild(tr);
    });

    msgTabela.textContent = `${lista.length} aparelho(s) encontrado(s) ${descricao}.`;
  }

  cidadeSelect.addEventListener("change", () => {
    atualizarSelectUnidades();
    tabelaCorpo.innerHTML = "";
    msgTabela.textContent = "Escolha uma unidade / código ou 'Todas as unidades'.";
  });

  unidadeSelect.addEventListener("change", () => {
    const cidade = cidadeSelect.value;
    const valor = unidadeSelect.value;

    let lista = TODOS_APARELHOS;
    if (cidade !== "todas") {
      lista = lista.filter(a => a.cidade === cidade);
    }

    if (!valor) {
      tabelaCorpo.innerHTML = "";
      msgTabela.textContent =
        "Escolha uma unidade / código ou 'Todas as unidades' para listar.";
      return;
    }

    if (valor === "todas") {
      preencherTabela(lista, `na cidade selecionada`);
    } else {
      const filtrados = lista.filter(a => a.unidadeExterna === valor);
      preencherTabela(filtrados, `para o código ${valor}`);
    }
  });

  carregarAparelhos();
</script>

</body>
</html>

