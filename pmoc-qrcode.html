<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QR Codes PMOC - Sistemas Maxi</title>

  <link rel="stylesheet" href="css/style.css">

  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#1e90ff" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- QRCodeJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    .qrcode-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .btn-imprimir {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      background: #1e90ff;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    .qr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }

    .qr-card {
      background: #fff;
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      text-align: center;
    }

    .qr-card h3 {
      margin: 4px 0 6px;
      font-size: 15px;
    }

    .qr-card p {
      margin: 0;
      font-size: 12px;
    }

    .qr-box {
      margin: 10px auto 4px;
    }

    .qr-url {
      font-size: 10px;
      word-break: break-all;
      color: #555;
      margin-top: 4px;
    }

    .filtros {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 8px;
    }

    .filtros select {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 13px;
    }

    @media print {
      .topbar,
      .sidebar,
      .qrcode-header {
        display: none !important;
      }
      body {
        background: #fff;
      }
      .qr-card {
        box-shadow: none;
        border: 1px solid #ddd;
      }
    }
  </style>
</head>
<body>

<header class="topbar">
  <button onclick="window.location.href='dashboard.html'" class="btn-voltar">â†</button>
  <h1>QR Codes PMOC</h1>
  <button onclick="logout()">Sair</button>
</header>

<nav class="sidebar">
  <ul>
    <li><a href="dashboard.html">ğŸ  Dashboard</a></li>
    <li><a href="ordem-servico.html">ğŸ“ Ordem de ServiÃ§o - ManutenÃ§Ã£o Corretiva</a></li>
    <li><a href="calendario.html">ğŸ“… Agenda</a></li>
    <li><a href="local.html">ğŸ“ Locais / Unidades</a></li>
    <li><a href="tecnico.html">ğŸ§‘â€ğŸ”§ TÃ©cnicos</a></li>
    <li><a href="usuarios.html">ğŸ‘¤ UsuÃ¡rios - Acesso ao Sistema</a></li>
    <li><a href="aparelhos-por-unidade.html">ğŸ¥ Aparelhos por unidade</a></li>
    <li><a href="pmoc.html">âœ… Checklist PMOC</a></li>
    <li><a href="pmoc-historico.html">ğŸ“‚ HistÃ³rico PMOC</a></li>
    <li><a href="pmoc-menu.html">ğŸ“Œ PMOC por cidade / unidade</a></li>
    <li><a href="pmoc-qrcode.html" class="active">ğŸ”³ QR Codes PMOC</a></li>
    <li><a href="pecas.html">ğŸ› ï¸ PeÃ§as / CatÃ¡logo</a></li>
  </ul>
</nav>

<main class="main-content">
  <div class="qrcode-header">
    <div>
      <h2>Gerar QR Codes para os aparelhos</h2>
      <p style="font-size:13px; color:#555;">
        Cada QR abre o histÃ³rico do aparelho em
        <code>pmoc-historico.html?aparelhoId=...</code>
      </p>
      <div class="filtros">
        <div>
          <label for="cidadeFilter" style="font-size:13px;">Cidade:</label><br>
          <select id="cidadeFilter">
            <option value="todas">Todas</option>
            <option value="SÃ£o Vicente">SÃ£o Vicente</option>
            <option value="SÃ£o Bernardo do Campo">SÃ£o Bernardo do Campo</option>
          </select>
        </div>
      </div>
      <p id="infoQuantidade" style="font-size:13px; color:#333;">
        0 QR Code(s) gerado(s).
      </p>
    </div>
    <button class="btn-imprimir" onclick="window.print()">Imprimir pÃ¡gina</button>
  </div>

  <section id="listaQRCodes" class="qr-grid"></section>
</main>

<script src="js/script.js"></script>

<script>
  // Mesma lista fixa do Hospital de ClÃ­nicas (SBC)
  const APARELHOS_SBC_HC = [
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-001", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-002", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-003", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-004", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-005", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-006", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-007", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-008", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-009", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-010", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-011", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-012", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-013", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-014", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-015", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-016", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-017", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-018", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-019", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-020", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-021", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-022", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-023", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-024", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-025", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-026", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-027", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-028", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-029", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-030", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-031", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-032", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-033", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-034", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-035", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-036", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-037", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-038", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-039", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-040", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-041", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-042", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-043", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-044", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-045", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-046", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-047", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-048", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-049", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-050", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-051", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-052", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-FC.-053", local: "", marca: "", btu: "", modelo: "" },

    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-001", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-002", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-003", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-004", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-005", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-006", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-007", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-008", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-009", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-010", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-011", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-012", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-013", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-014", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-016", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-017", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-018", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-019", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-020", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-021", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-022", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-023", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-024", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-025", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-026", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-027", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-028", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-029", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-030", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-031", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-032", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-033", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-034", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-037", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-038", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-039", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-040", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-041", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-042", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-043", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-044", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-045", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-046", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-047", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-048", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-049", local: "", marca: "", btu: "", modelo: "" },
    { cidade: "SÃ£o Bernardo do Campo", hospital: "Hospital de ClÃ­nicas", unidadeExterna: "HCLI-MSS-050", local: "", marca: "", btu: "", modelo: "" }
  ];

  const API_APARELHOS_URL = "https://aircontrolos-api.onrender.com/api/aparelhos-hdv";

  const listaQRCodes = document.getElementById("listaQRCodes");
  const infoQuantidade = document.getElementById("infoQuantidade");
  const cidadeFilter = document.getElementById("cidadeFilter");

  let TODOS_APARELHOS = [];

  async function carregarAparelhosDoBanco() {
    listaQRCodes.innerHTML = "";
    infoQuantidade.textContent = "Carregando aparelhos...";

    try {
      const resp = await fetch(API_APARELHOS_URL);
      let dados = [];
      if (resp.ok) {
        dados = await resp.json();
      }

      const aparelhosSV = Array.isArray(dados)
        ? dados.map(ap => ({
            cidade: ap.cidade || "SÃ£o Vicente",
            hospital: ap.hospital || "",
            unidadeExterna: ap.unidadeExterna,
            local: ap.local,
            marca: ap.marca,
            btu: ap.btu,
            modelo: ap.modelo
          }))
        : [];

      TODOS_APARELHOS = [...aparelhosSV, ...APARELHOS_SBC_HC];

      if (!TODOS_APARELHOS.length) {
        infoQuantidade.textContent = "Nenhum aparelho encontrado.";
        return;
      }

      renderizarQRCodes();
    } catch (e) {
      console.error(e);
      infoQuantidade.textContent = "Erro ao carregar aparelhos para gerar QR Codes.";
    }
  }

  function renderizarQRCodes() {
    const cidadeSelecionada = cidadeFilter.value;
    listaQRCodes.innerHTML = "";
    let totalGerados = 0;

    let lista = TODOS_APARELHOS;
    if (cidadeSelecionada !== "todas") {
      lista = lista.filter(a => a.cidade === cidadeSelecionada);
    }

    if (!lista.length) {
      infoQuantidade.textContent = "Nenhum aparelho para esta cidade.";
      return;
    }

    const baseUrlHistorico = `${window.location.origin}/pmoc-historico.html`;

    lista.forEach(ap => {
      const aparelhoId = ap.unidadeExterna;

      const desc =
        ap.modelo ||
        ap.descricao ||
        (ap.marca && ap.btu ? `${ap.marca} ${ap.btu} BTU` : "Ar condicionado");

      const unidadeExt = ap.unidadeExterna ?? "-";
      const local = ap.local || "";
      const cidadeText = ap.cidade || "";
      const hospitalText = ap.hospital || "";

      const card = document.createElement("article");
      card.className = "qr-card";

      const titulo = document.createElement("h3");
      titulo.textContent = `#${aparelhoId ?? "?"} - ${desc}`;

      const info = document.createElement("p");
      info.textContent = `${cidadeText} â€¢ ${hospitalText} â€¢ Unidade: ${unidadeExt}`;

      const info2 = document.createElement("p");
      info2.textContent = local ? `Local / ambiente: ${local}` : "";

      const qrBox = document.createElement("div");
      qrBox.className = "qr-box";

      const urlTexto = document.createElement("div");
      urlTexto.className = "qr-url";

      card.appendChild(titulo);
      card.appendChild(info);
      if (local) card.appendChild(info2);
      card.appendChild(qrBox);
      card.appendChild(urlTexto);

      listaQRCodes.appendChild(card);

      if (
        aparelhoId !== null &&
        aparelhoId !== undefined &&
        aparelhoId !== "-" &&
        aparelhoId !== ""
      ) {
        const urlHistorico =
          `${baseUrlHistorico}?aparelhoId=${encodeURIComponent(aparelhoId)}`;

        urlTexto.textContent = urlHistorico;

        if (typeof QRCode !== "undefined") {
          new QRCode(qrBox, {
            text: urlHistorico,
            width: 128,
            height: 128
          });
          totalGerados++;
        } else {
          qrBox.textContent = "Erro ao carregar biblioteca de QR Code.";
        }
      } else {
        qrBox.textContent = "NÃ£o foi possÃ­vel gerar QR (sem ID).";
        urlTexto.textContent = "";
      }
    });

    infoQuantidade.textContent = `${totalGerados} QR Code(s) gerado(s).`;
  }

  cidadeFilter.addEventListener("change", renderizarQRCodes);

  document.addEventListener("DOMContentLoaded", () => {
    carregarAparelhosDoBanco();
  });
</script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("./service-worker.js", { scope: "./" })
      .catch(console.error);
  }
</script>

</body>
</html>
