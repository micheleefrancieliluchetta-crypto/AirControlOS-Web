<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QR Codes PMOC - Sistemas Maxi</title>

  <link rel="stylesheet" href="css/style.css">

  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#1e90ff" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- QRCodeJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    .qrcode-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn-imprimir {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      background: #1e90ff;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }
    .qr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }
    .qr-card {
      background: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      max-width: 260px;
      margin: 0 auto;
      font-size: 11px;
    }
    .qr-card-topo {
      display: flex;
      justify-content: space-between;
      font-weight: bold;
      font-size: 11px;
      margin-bottom: 6px;
    }
    .qr-box {
      margin: 4px auto;
      width: 130px;
      height: 130px;
    }
    .qr-card-rodape {
      border-top: 1px solid #e5e7eb;
      margin-top: 6px;
      padding-top: 6px;
      font-size: 10px;
      line-height: 1.3;
    }
    @media print {
      .topbar,
      .sidebar,
      .qrcode-header {
        display: none !important;
      }
      body { background: #fff; }
      .qr-card {
        box-shadow: none;
        border: 1px solid #ddd;
      }
    }
  </style>
</head>

<body>

<header class="topbar">
  <button onclick="window.location.href='dashboard.html'" class="btn-voltar">‚Üê</button>
  <h1>QR Codes PMOC</h1>
  <button onclick="logout()">Sair</button>
</header>

<nav class="sidebar">
  <ul>
    <li><a href="dashboard.html">üè† Dashboard</a></li>
    <li><a href="ordem-servico.html">üìù Ordem de Servi√ßo</a></li>
    <li><a href="calendario.html">üìÖ Agenda</a></li>
    <li><a href="local.html">üìç Locais / Unidades</a></li>
    <li><a href="tecnico.html">üßë‚Äçüîß T√©cnicos</a></li>
    <li><a href="usuarios.html">üë§ Usu√°rios</a></li>
    <li><a href="aparelhos-por-unidade.html">üè• Aparelhos por unidade</a></li>
    <li><a href="pmoc.html">‚úÖ Checklist PMOC</a></li>
    <li><a href="pmoc-historico.html">üìÇ Hist√≥rico PMOC</a></li>
    <li><a href="pmoc-menu.html">üìå PMOC por cidade</a></li>
    <li><a href="pmoc-qrcode.html" class="active">üî≥ QR Codes PMOC</a></li>
  </ul>
</nav>

<main class="main-content">
  <div class="qrcode-header">
    <div>
      <h2>Gerar QR Codes para os aparelhos</h2>
      <p style="font-size:13px; color:#555;">
        Cada QR abre o hist√≥rico do aparelho em<br>
        <code>pmoc-historico.html?equipId=...</code>
      </p>

      <label style="font-size:13px;">Cidade:</label><br>
      <select id="cidadeFilter">
        <option value="todas">Todas</option>
        <option value="S√£o Vicente">S√£o Vicente</option>
        <option value="S√£o Bernardo do Campo">S√£o Bernardo do Campo</option>
      </select>

      <p id="infoQuantidade" style="font-size:13px; margin-top:6px;">0 QR gerados</p>
    </div>

    <button class="btn-imprimir" onclick="window.print()">Imprimir p√°gina</button>
  </div>

  <section id="listaQRCodes" class="qr-grid"></section>
</main>

<script>
/* ============================================================
   1) LISTA FIXA ‚Äì HOSPITAL DE CL√çNICAS DE S√ÉO BERNARDO DO CAMPO
      FC-001 a FC-053 + MSS-001 a MSS-050
   ============================================================ */

const APARELHOS_SBC_HC = [
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-001" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-002" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-003" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-004" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-005" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-006" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-007" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-008" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-009" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-010" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-011" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-012" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-013" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-014" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-015" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-016" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-017" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-018" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-019" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-020" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-021" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-022" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-023" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-024" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-025" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-026" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-027" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-028" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-029" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-030" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-031" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-032" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-033" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-034" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-035" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-036" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-037" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-038" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-039" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-040" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-041" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-042" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-043" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-044" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-045" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-046" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-047" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-048" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-049" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-050" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-051" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-052" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-FC.-053" },

  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-001" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-002" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-003" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-004" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-005" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-006" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-007" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-008" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-009" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-010" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-011" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-012" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-013" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-014" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-015" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-016" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-017" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-018" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-019" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-020" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-021" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-022" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-023" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-024" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-025" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-026" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-027" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-028" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-029" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-030" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-031" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-032" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-033" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-034" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-035" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-036" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-037" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-038" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-039" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-040" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-041" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-042" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-043" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-044" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-045" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-046" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-047" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-048" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-049" },
  { cidade:"S√£o Bernardo do Campo", hospital:"Hospital de Cl√≠nicas", unidadeExterna:"HCLI-MSS-050" }
];

/* ============================================================
   2) APARELHOS DE S√ÉO VICENTE (API .NET)
   ============================================================ */

const API_APARELHOS_URL = "https://aircontrolos-api.onrender.com/api/aparelhos-hdv";

const listaQRCodes   = document.getElementById("listaQRCodes");
const infoQuantidade = document.getElementById("infoQuantidade");
const cidadeFilter   = document.getElementById("cidadeFilter");

// Come√ßa j√° com S√£o Bernardo carregado
let TODOS_APARELHOS = [...APARELHOS_SBC_HC];

// Carrega aparelhos de S√£o Vicente (API) e junta com SBC
async function carregarAparelhosDoBanco() {
  listaQRCodes.innerHTML = "";
  infoQuantidade.textContent = "Carregando aparelhos...";

  try {
    const resp = await fetch(API_APARELHOS_URL);
    let dados = [];

    if (resp.ok) {
      dados = await resp.json();
    }

    const aparelhosSV = Array.isArray(dados)
      ? dados.map(ap => ({
          cidade:   ap.cidade || "S√£o Vicente",
          hospital: ap.hospital || "",
          unidadeExterna: ap.unidadeExterna,
          local:    ap.local,
          marca:    ap.marca,
          btu:      ap.btu,
          modelo:   ap.modelo || ""
        }))
      : [];

    // S√£o Vicente (API) + S√£o Bernardo (fixo)
    TODOS_APARELHOS = [...aparelhosSV, ...APARELHOS_SBC_HC];

  } catch (erro) {
    console.error("Erro na API de S√£o Vicente:", erro);
    // Se der erro, mant√©m pelo menos S√£o Bernardo
    TODOS_APARELHOS = [...APARELHOS_SBC_HC];
    infoQuantidade.textContent = "Erro na API. Mostrando apenas S√£o Bernardo do Campo.";
  }

  if (!TODOS_APARELHOS.length) {
    infoQuantidade.textContent = "Nenhum aparelho encontrado.";
    return;
  }

  renderizarQRCodes();
}

// Descobre texto do modelo para exibir no cart√£o
function descobrirModelo(ap) {
  // üîß CORRE√á√ÉO: garante que cod √© STRING
  const cod = String(ap.unidadeExterna || "");

  if (ap.modelo && ap.modelo.trim() !== "") return ap.modelo;

  if (cod.includes("HCLI-FC"))  return "Fancoil";
  if (cod.includes("HCLI-MSS")) return "MSS - Mini Split System";

  if (ap.marca && ap.btu) return `${ap.marca} ${ap.btu} BTU`;
  return "Ar condicionado";
}

// Renderiza todos os cart√µes de QR Code
function renderizarQRCodes() {
  const cidadeSelecionada = cidadeFilter.value;
  listaQRCodes.innerHTML = "";
  let totalGerados = 0;

  let lista = TODOS_APARELHOS;

  if (cidadeSelecionada !== "todas") {
    lista = lista.filter(a => a.cidade === cidadeSelecionada);
  }

  if (!lista.length) {
    infoQuantidade.textContent = "Nenhum aparelho para esta cidade.";
    return;
  }

  const baseUrlHistorico = `${window.location.origin}/pmoc-historico.html`;

  lista.forEach(ap => {
    const aparelhoId   = ap.unidadeExterna;
    const tipoOuModelo = descobrirModelo(ap);
    const unidadeExt   = ap.unidadeExterna ?? "-";
    const local        = ap.local || "";
    const cidadeText   = ap.cidade || "";
    const hospitalText = ap.hospital || "";

    const card = document.createElement("article");
    card.className = "qr-card";

    const topo = document.createElement("div");
    topo.className = "qr-card-topo";
    topo.innerHTML = `
      <span>Maxi Servi√ßos</span>
      <span style="font-size:9px; text-align:right;">
        sistemasmaxi.vercel.app<br>(11) 99999-9999
      </span>
    `;

    const qrBox = document.createElement("div");
    qrBox.className = "qr-box";

    const rodape = document.createElement("div");
    rodape.className = "qr-card-rodape";
    rodape.innerHTML = `
      <strong>${hospitalText || "Hospital"}</strong>
      ${tipoOuModelo}<br>
      ${unidadeExt}${local ? "<br>" + local : ""}
    `;

    card.appendChild(topo);
    card.appendChild(qrBox);
    card.appendChild(rodape);
    listaQRCodes.appendChild(card);

    if (aparelhoId) {
      const params = new URLSearchParams({
        equipId: aparelhoId,
        codigo:  unidadeExt,
        hospital: hospitalText,
        cidade:   cidadeText
      });

      const urlHistorico = `${baseUrlHistorico}?${params.toString()}`;

      if (typeof QRCode !== "undefined") {
        new QRCode(qrBox, {
          text: urlHistorico,
          width: 128,
          height: 128
        });
        totalGerados++;
      } else {
        qrBox.textContent = "Erro ao carregar biblioteca de QR Code.";
      }
    } else {
      qrBox.textContent = "N√£o foi poss√≠vel gerar QR (sem ID).";
    }
  });

  infoQuantidade.textContent = `${totalGerados} QR Code(s) gerado(s).`;
}

// Eventos
cidadeFilter.addEventListener("change", renderizarQRCodes);

document.addEventListener("DOMContentLoaded", () => {
  carregarAparelhosDoBanco();
});
</script>

<script>
  // Service Worker para PWA
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("./service-worker.js", { scope: "./" })
      .catch(console.error);
  }
</script>

</body>
</html>
